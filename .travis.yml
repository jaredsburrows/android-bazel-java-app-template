language: android

matrix:
  include:
    - dist: trusty
      jdk: oraclejdk8

env:
  - BAZEL_VERSION=0.27.0

install:
  # Download SDK
  - yes | sdkmanager "tools" &>/dev/null
  - yes | sdkmanager "platform-tools" &>/dev/null
  - yes | sdkmanager "platforms;android-28" &>/dev/null
  - yes | sdkmanager "build-tools;28.0.3" &>/dev/null
  # Update remaining dependencies and accept licenses
  - yes | sdkmanager --update &>/dev/null
  - yes | sdkmanager --licenses &>/dev/null
  - sudo apt-get install libstdc++6
  - sudo apt-get update -qq
  - sudo apt-get install -y netcat-traditional
  - sudo update-alternatives --set nc /bin/nc.traditional
  - export JAVA_HOME=/usr/lib/jvm/java-8-oracle
  - URL="https://github.com/bazelbuild/bazel/releases/download/${BAZEL_VERSION}/bazel-${BAZEL_VERSION}-installer-linux-x86_64.sh"
  - wget -O install.sh "${URL}"
  - chmod +x install.sh
  - ./install.sh --user
  - rm -f install.sh

script:
  - bazel test //... --disk_cache=$HOME/.cache/bazel_disk_cache --show_progress_rate_limit=5 --test_output=errors

cache:
  directories:
    - $HOME/.cache/bazel_disk_cache
    - $HOME/.cache/coursier

branches:
  except:
    - gh-pages

sudo: required
